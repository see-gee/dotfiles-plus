#autoload
if [[ -z $DOTFILES_GIT_REMOTE_URL ]]; then   
  echo "'$DOTFILES_GIT_REMOTE_URL' is not set."
  read "url?Please enter the url for your dotfiles repository: "
  echo "Validating repository url:"
  if [[ $(_dotfiles_git_cmd ls-remote $url) = 0 ]]; then
    echo "Repository url is valid."
    DOTFILES_GIT_REMOTE_URL="$url"
  else
    echo "Unable to validate repo url."

fi

if [[ -z $DOTFILES_GIT_DIR ]]; then 
  echo "'$DOTFILES_GIT_DIR' is not set. This needs to be defined before the script can continue"
  exit 1
fi
echo "'$DOTFILES_GIT_DIR' is set as: $DOTFILES_GIT_DIR"
echo "Your '$DOTFILES_GIT_REMOTE_URL' is set as: $DOTFILES_GIT_REMOTE_URL"

# Create and initialize the repo
if [[ ! -d $DOTFILES_GIT_DIR ]]; then
  echo "Creating directory: $DOTFILES_GIT_DIR"
  mkdir $DOTFILES_GIT_DIR
  echo "Initializing dotfiles git repo:"
  _dotfiles_git_cmd init --bare -b main
  echo "Setting up remote:"
  _dotfiles_git_cmd remote add origin $DOTFILES_GIT_REMOTE_URL
  if [[ $(_dotfiles_git_cmd ls-remote --get-url origin) != 0 ]]; then
    echo "Error: Remote was not set successfully"
    exit $?
  else
    echo "Remote set: $(_dotfiles_git_cmd ls-remote --get-url)"
  fi
    
  echo "adding the basics
else
  echo "$DOTFILES_GIT_DIR directory already exists. 
  Move or delete to create a new repository"
  return 1
fi

